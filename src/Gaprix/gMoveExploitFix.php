<?php

/*
 *   _____                  _      
 *  / ____|                (_)     
 * | |  __  __ _ _ __  _ __ ___  __
 * | | |_ |/ _` | '_ \| '__| \ \/ /
 * | |__| | (_| | |_) | |  | |>  < 
 *  \_____|\__,_| .__/|_|  |_/_/\_\
 *              | |                
 *              |_|                
*/

namespace Gaprix;

use pocketmine\plugin\PluginBase;
use pocketmine\event\server\DataPacketReceiveEvent;
use pocketmine\network\mcpe\protocol\MovePlayerPacket;
use pocketmine\event\Listener;

class gMoveExploitFix extends PluginBase implements Listener
{

    public function onEnable(){
        $this->getServer()->getPluginManager()->registerEvents($this, $this);
    }

    public function onPacket(DataPacketReceiveEvent $e){
        $pk = $e->getPacket();
        $player = $e->getPlayer();

        if($pk instanceof MovePlayerPacket){
            $maxX = $pk->x > $player->x ? $pk->x : $player->x;
            $minX = $pk->x < $player->x ? $pk->x : $player->x;
            $maxZ = $pk->z < $player->z ? $pk->z : $player->z;
            $minZ = $pk->z < $player->z ? $pk->z : $player->z;
            $maxY = $pk->y < $player->y ? $pk->y : $player->y;
            $minY = $pk->y < $player->y ? $pk->y : $player->y;

            if($maxX - $minX > 20 || $maxZ - $minZ > 20 || $maxY - $minY > 20){
                $e->setCancelled();
            }
        }
    }

}